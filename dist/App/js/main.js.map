{"version":3,"sources":["../../../App/js/main.js"],"names":["window","onload","chat","Chat","init","socket","prototype","TYPING_TIMER_LENGTH","reg","login_input","$","focus","login_info","msgArea","bgTotalNum","boxList","btnList","audioList","that","userName","font","color","font_weight","font_style","text_decoration","font_size","font_family","typing","lastTypingTime","isShake","currentInput","bgNum","bgFlag","_initialPopup","click","val","trim","html","length","isNaN","test","emit","on","className","css","setTimeout","i","styleList","e","_changeFontBtn","_changFontBox","_changeFont","title","addClass","trigger","removeClass","files","file","reader","FileReader","_displayNewMsg","value","readAsDataURL","target","result","toggleClass","is","container","divList","fadeOut","slideDown","containerSH","scrollHeight","animate","each","n","self","styleName","active","normal","hasClass","replace","controlBox","fadeIn","stopPropagation","controlBtn","siblings","innerHTML","Date","getTime","typingTimer","timeDiff","location","reload","msg","keydown","keyCode","preventDefault","event","ctrlKey","metaKey","altKey","io","connect","removeAttr","attr","document","nickName","users","type","_displayUsers","user","img","status","item","textContent","split","find","emojiBox","colorLiList","famLiList","sizeLiList","li","userColor","date","toLocaleString","div","createElement","_showEmoji","append","scrollTop","me","match","emojiIndex","totalEmojiNum","children","exec","slice"],"mappings":"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","file":"main.js","sourcesContent":["/**\r\n * Created by GiantR on 2016/12/15.\r\n */\r\n'use strict';\r\nwindow.onload = function () {\r\n    //实例并初始化my chat程序\r\n    let chat = new Chat();\r\n    chat.init();\r\n};\r\n\r\n//定义Chat类\r\nconst Chat = function () {\r\n    this.socket = null;\r\n};\r\n\r\n//向原型添加业务方法\r\nChat.prototype = {\r\n//  初始化程序\r\n    init: function () {\r\n        //初始化常量\r\n        const TYPING_TIMER_LENGTH = 500,  //输入延时\r\n            reg = /^[\\w\\u4e00-\\u9fa5]*$/,  //用户名匹配正则\r\n            login_input = $('input.login_input').focus(),    //用户名输入框\r\n            login_info = $('div.login_info'),  //登陆信息框\r\n            msgArea = $('textarea.msg'),    //信息输入框\r\n            bgTotalNum = 6,  //背景图总数\r\n            boxList = [\r\n                $('ul.font_size_box'),  //字号弹窗\r\n                $('ul.font_family_box'),    //字体弹窗\r\n                $('ul.font_color_box'),  //颜色弹窗\r\n                $('div.emoji_box')  //表情弹窗\r\n            ],\r\n            btnList = [\r\n                $('span.sprite-size'),  //字号按钮\r\n                $('span.sprite-family'),    //字体按钮\r\n                $('span.sprite-color'), //颜色按钮\r\n                $('span.sprite-emoji')  //表情按钮\r\n            ],\r\n            audioList = [\r\n                $('audio.audio_msg'),\r\n                $('audio.audio_global'),\r\n                $('audio.audio_sys')\r\n            ];\r\n        //初始化变量\r\n        let that = this,\r\n            userName = '',  //用户名\r\n            font = {\r\n                color: '#000', //颜色\r\n                font_weight: 'normal', //粗细\r\n                font_style: 'normal',  //倾斜\r\n                text_decoration: 'none',    //下划线\r\n                font_size: '16px', //字号\r\n                font_family: 'Microsoft Yahei' //字体\r\n            },\r\n            typing = false, //输入状态\r\n            lastTypingTime, //上次输入时间\r\n            isShake = true, //是否接受抖动信息\r\n            currentInput = login_input, //当前可输入元素\r\n            bgNum = 1,  //当前背景图序号\r\n            bgFlag = true;  //能否变更背景图\r\n\r\n        //页面事件\r\n        //    初始化弹窗\r\n        this._initialPopup();\r\n        //    昵称设置的确定按钮\r\n        $('input.login_btn').click(function () {\r\n            userName = login_input.val().trim();\r\n            //   检查昵称输入框是否为空\r\n            if (!userName) {\r\n                login_info.html('小白这个名字怎么样');\r\n            } else if (userName.length > 16) {\r\n                login_info.html('你这名字也忒长了');\r\n            } else if (!isNaN(userName[0])) {\r\n                login_info.html('数字不可以打头阵');\r\n            } else if (!reg.test(userName)) {\r\n                login_info.html('除了字母、汉字、数字或_ 其他统统不要');\r\n            } else {\r\n                that.socket.emit('login', userName);\r\n            }\r\n        });\r\n        //    切换背景事件\r\n        $('div.bgChange_box').on('click', 'span', function () {\r\n            if (!bgFlag) {\r\n                return;\r\n            }\r\n            bgFlag = false;\r\n            if (this.className == 'forward') {//向前\r\n                if (bgNum == 1) {\r\n                    bgNum = bgTotalNum;\r\n                } else {\r\n                    bgNum--;\r\n                }\r\n            } else {  //向后\r\n                if (bgNum == bgTotalNum) {\r\n                    bgNum = 1;\r\n                } else {\r\n                    bgNum++;\r\n                }\r\n            }\r\n            $('div.stage').css('background-image', 'url(\"../resource/stage_bg/' + bgNum + '.jpg\")');\r\n            setTimeout(function () {\r\n                bgFlag = true;\r\n            }, 500);\r\n        });\r\n        //    字号改变、字体改变、颜色改变\r\n        for(let i = 0; i < 3; i++){\r\n            const styleList = ['font_size','font_family','color'];\r\n            btnList[i].click(function (e) {\r\n                _changeFontBtn(this, boxList[i], e);\r\n            });\r\n            boxList[i].on('click', 'li', function () {\r\n                _changFontBox(this, btnList[i], styleList[i]);\r\n            });\r\n        }\r\n        //    字体加粗\r\n        $('span.sprite-bold').click(function () {\r\n            _changeFont(this, 'font_weight', 'bold', 'normal');\r\n        });\r\n        //    字体倾斜\r\n        $('span.sprite-italic').click(function () {\r\n            _changeFont(this, 'font_style', 'italic', 'normal');\r\n        });\r\n        //    字体下划线\r\n        $('span.sprite-underline').click(function () {\r\n            _changeFont(this, 'text_decoration', 'underline', 'none');\r\n        });\r\n        //    表情被点击\r\n        btnList[3].click(function (e) {\r\n            _changeFontBtn(this, $('div.emoji_box'), e);\r\n        });\r\n        boxList[3].on('click', 'img', function () {\r\n            msgArea.focus();\r\n            msgArea.val(msgArea.val() + '[emoji:' + this.title + ']');\r\n        });\r\n        //    发送图片\r\n        $('span.sprite-pic').click(function () {\r\n            $(this).addClass('active');\r\n            $('#img').trigger('click');\r\n            setTimeout(function () {\r\n                $('span.sprite-pic').removeClass('active');\r\n            }, 1000);\r\n        });\r\n        $('#img').on('change', function () {\r\n            $('span.sprite-pic').removeClass('active');\r\n            if (this.files.length != 0) {\r\n                //获取文件并用fileReader进行读取\r\n                let file = this.files[0],\r\n                    reader = new FileReader();\r\n                if (!reader) {\r\n                    that._displayNewMsg('系统', '当前浏览器不支持文件读取,请升级至最新版本');\r\n                    this.value = '';\r\n                    return;\r\n                }\r\n                reader.readAsDataURL(file);//读取文件为数据url格式\r\n                reader.onload = function (e) {\r\n                    //    读取成功,显示到页面并发送到服务器\r\n                    this.value = '';\r\n                    that.socket.emit('postImg', e.target.result);\r\n                };\r\n            }\r\n        });\r\n        //    窗口抖动\r\n        $('span.sprite-shake').click(function () {\r\n            $(this).addClass('active');\r\n            that.socket.emit('shake');\r\n            setTimeout(function () {\r\n                $('span.sprite-shake').removeClass('active');\r\n            }, 1000);\r\n        });\r\n        //    取消抖动\r\n        $('span.sprite-ban').on('click', function () {\r\n            $(this).toggleClass('active');\r\n            isShake = !$(this).is('.active');\r\n        });\r\n        //    清除历史消息\r\n        $('span.sprite-clear').click(function () {\r\n            const container = $('.article'),\r\n                that = this;\r\n            let divList = $('div.article div');\r\n            divList.is(':visible') ? divList.fadeOut(function () {\r\n                that.title = '展开历史消息';\r\n                $(that).addClass('active');\r\n            }) : divList.slideDown(function () {\r\n                let containerSH = container[0].scrollHeight;\r\n                container.animate({'scrollTop': containerSH}, 'fast');\r\n                that.title = '收起历史消息';\r\n                $(that).removeClass('active');\r\n            });\r\n        });\r\n\r\n        //    点击其他区域弹框消失\r\n        $('body').click(function (e) {\r\n            $.each(boxList, function (i, n) {\r\n                if (e.target != n[0]) {\r\n                    n.fadeOut('fast');\r\n                    btnList[i].removeClass('active')\r\n                }\r\n            });\r\n        });\r\n\r\n        //    按钮自身控制事件\r\n        function _changeFont(self, styleName, active, normal) {\r\n            $(self).toggleClass('active');\r\n            if ($(self).hasClass('active')) {\r\n                font[styleName] = active;\r\n            } else {\r\n                font[styleName] = normal;\r\n            }\r\n            msgArea.css(styleName.replace('_', '-'), font[styleName]).focus();\r\n        }\r\n\r\n        //    控制按钮事件\r\n        function _changeFontBtn(self, controlBox, e) {\r\n            $.each(boxList, function (i, n) {\r\n                if (n.is(':visible')) {\r\n                    n.fadeOut('fast');\r\n                    btnList[i].removeClass('active')\r\n                }\r\n            });\r\n            $(self).addClass('active');\r\n            controlBox.fadeIn('fast');\r\n            e.stopPropagation();\r\n        }\r\n\r\n        //    控制容器事件\r\n        function _changFontBox(self, controlBtn, styleName) {\r\n            $(self).addClass('active').siblings().removeClass('active');\r\n            controlBtn.removeClass('active');\r\n            font[styleName] = self.innerHTML;\r\n            msgArea.css(styleName.replace('_', '-'), font[styleName]).focus();\r\n        }\r\n\r\n        //    正在输入\r\n        msgArea.on('input', function () {\r\n            const self = that;\r\n            if (!typing) {\r\n                typing = true;\r\n                self.socket.emit('typing', '1');\r\n            }\r\n            lastTypingTime = (new Date()).getTime();\r\n\r\n            setTimeout(function () {\r\n                let typingTimer = (new Date()).getTime(),\r\n                    timeDiff = typingTimer - lastTypingTime;\r\n                if (timeDiff >= TYPING_TIMER_LENGTH && typing) {\r\n                    self.socket.emit('typing', '0');\r\n                    typing = false;\r\n                }\r\n            }, TYPING_TIMER_LENGTH);\r\n        });\r\n        //    退出登陆\r\n        $('input.close').click(function () {\r\n            location.reload(true);\r\n        });\r\n        //    清空输入\r\n        $('input.clear').click(function () {\r\n            msgArea.val('').focus();\r\n        });\r\n        //    发送消息按钮\r\n        $('input.sent').click(function () {\r\n            let msg = msgArea.val();\r\n            msgArea.val('');\r\n            msgArea.focus();\r\n            if (msg.trim().length != 0) {\r\n                that.socket.emit('postMsg', msg, font);\r\n            }\r\n        });\r\n\r\n        //快捷操作\r\n\r\n        login_input.keydown(function (e) {\r\n            if (e.keyCode == 13) {\r\n                $('input.login_btn').trigger('click');\r\n                e.preventDefault();\r\n            }\r\n        });\r\n        msgArea.keydown(function (e) {\r\n            if (e.keyCode == 13) {\r\n                $('input.sent').trigger('click');\r\n                e.preventDefault();\r\n            }\r\n        });\r\n        $('div.modal').click(function () {\r\n            login_input.focus();\r\n        });\r\n        $(window).keydown(function () {\r\n            if (!(event.ctrlKey || event.metaKey || event.altKey)) {\r\n                currentInput.focus();\r\n            }\r\n        });\r\n\r\n        //socket事件\r\n\r\n        //    建立到服务器的socket连接\r\n        this.socket = io.connect();\r\n        //    监听socket的connect事件,此事件表示连接已经建立\r\n        this.socket.on('connect', function () {\r\n            //    连接到服务器后显示昵称输入框\r\n            login_info.html('已连接');\r\n            if (userName) {\r\n                $('input.login_btn').trigger('click');\r\n                return;\r\n            }\r\n            $('div.login_form input').removeAttr('disabled');\r\n            login_input.focus();\r\n        });\r\n        //    连接断开\r\n        this.socket.on('disconnect', function () {\r\n            login_info.html('<span>正在重新连接</span>');\r\n            $('div.login_form input').attr('disabled', 'disabled');\r\n            $('div.modal').fadeIn();\r\n            $('div.stage').fadeOut();\r\n        });\r\n        //    若昵称已存在\r\n        this.socket.on('nameExisted', function () {\r\n            login_info.html('被冒名顶替了');\r\n        });\r\n        //    昵称可用\r\n        this.socket.on('loginSucc', function () {\r\n            $('div.article').html('');\r\n            document.title = `My Chat | ${userName}`;\r\n            $('span.title').html(`<small>${userName}</small>`);\r\n            $('div.modal').fadeOut();\r\n            $('div.stage').fadeIn();\r\n            currentInput = msgArea;\r\n            msgArea.focus();\r\n        });\r\n        //    接收系统信息\r\n        this.socket.on('sys', function (nickName, users, type) {\r\n            //    判断用户是连接还是离开以显示不同的信息\r\n            let msg = nickName + (type == 'login' ? ' 已加入' : ' 已离开');\r\n            that._displayNewMsg('系统', msg);\r\n            //    将在线用户显示在侧边栏\r\n            that._displayUsers(users, userName);\r\n        });\r\n        //    接收新消息\r\n        this.socket.on('newMsg', function (user, msg, font) {\r\n            (user == userName) && (user = '我');\r\n            that._displayNewMsg(user, msg, font);\r\n        });\r\n        //    接收图片\r\n        this.socket.on('newImg', function (user, img) {\r\n            (user == userName) && (user = '我');\r\n            that._displayNewMsg(user, null, null, img);\r\n        });\r\n        //   监听输入状态\r\n        this.socket.on('typing', function (user, status) {\r\n            // 正在输入\r\n            $('ul.users li').each(function (i, e) {\r\n                let item = e.textContent.split(' ')[0];\r\n                if (item == user) {\r\n                    if (status == '1') {\r\n                        $(e).find('span').fadeIn();\r\n                    } else {\r\n                        $(e).find('span').fadeOut();\r\n                    }\r\n                }\r\n\r\n\r\n            });\r\n        });\r\n        //   监听抖动\r\n        this.socket.on('shake', function (user) {\r\n            if (user == userName) {\r\n                user = '我'\r\n            }\r\n            that._displayNewMsg('系统', user + ' 发送了一个窗口抖动');\r\n            if (!isShake) {\r\n                return\r\n            }\r\n            $('div.container').addClass('shake');\r\n            setTimeout(function () {\r\n                $('div.container').removeClass('shake');\r\n            }, 1000);\r\n        });\r\n    },\r\n//    初始化弹窗\r\n    _initialPopup: function () {\r\n        //Emoji\r\n        const emojiBox = $('div.emoji_box'),\r\n            colorLiList = $('ul.font_color_box li'),\r\n            famLiList = $('ul.font_family_box li'),\r\n            sizeLiList = $('ul.font_size_box li');\r\n        let html = '';\r\n        for (let i = 69; i > 0; i--) {\r\n            html += `<img src=\"../resource/emoji/${i}.gif\" title=\"${i}\">`;\r\n        }\r\n        emojiBox.html(html);\r\n        //color\r\n        for (let i = 0; i < colorLiList.length; i++) {\r\n            let li = colorLiList[i];\r\n            $(li).css({'background-color': li.innerHTML, 'color': li.innerHTML});\r\n        }\r\n        //font-family\r\n        for (let i = 0; i < famLiList.length; i++) {\r\n            let li = famLiList[i];\r\n            $(li).css({'font-family': li.innerHTML});\r\n        }\r\n        //font-size\r\n        for (let i = 0; i < sizeLiList.length; i++) {\r\n            let li = sizeLiList[i];\r\n            $(li).css({'font-size': li.innerHTML});\r\n        }\r\n    },\r\n//    显示新消息\r\n    _displayNewMsg: function (user, msg, font, img) {\r\n        let container = $('.article'),\r\n            userColor = '',\r\n            date = new Date().toLocaleString(),\r\n            div = document.createElement('div');\r\n        if (user == '系统' || msg == '\"发送了一个窗口抖动\"') {\r\n            userColor = 'font_red';\r\n            div.className = 'sysMsg';\r\n            font = {\r\n                color: '#666', //颜色\r\n                font_weight: 'normal', //粗细\r\n                font_style: 'normal',  //倾斜\r\n                text_decoration: 'none',    //下划线\r\n                font_size: '14px', //字号\r\n                font_family: 'Microsoft Yahei' //字体\r\n            }\r\n        } else if (user == '我') {\r\n            userColor = 'font_purple';\r\n            div.className += ' myMsg';\r\n        }\r\n        div.className += ' newMsg';\r\n        if (img) {\r\n            div.innerHTML = `\r\n              <h4 class=\"${userColor}\">${user}<small>${date}</small></h4>\r\n              <p>\r\n                <a href=\"${img}\" target=\"_blank\" title=\"查看原图\"><img src=\"${img}\"></a>\r\n              </p>`;\r\n        } else {\r\n            div.innerHTML = `\r\n              <h4 class=\"${userColor}\">${user}<small>${date}</small></h4>\r\n              <p style=\"color:${font.color};\r\n                        font-weight:${font.font_weight};\r\n                        font-style: ${font.font_style};\r\n                        text-decoration: ${font.text_decoration};\r\n                        font-size: ${font.font_size};\r\n                        font-family: ${font.font_family};\">\r\n                ${this._showEmoji(msg)}\r\n              </p>`;\r\n        }\r\n        container.append(div);\r\n        container[0].scrollTop = container[0].scrollHeight;\r\n        $('span.sprite-clear').attr('title', '收起历史消息').removeClass('active');\r\n        setTimeout(function () {\r\n            $(div).removeClass(' newMsg');\r\n        }, 500);\r\n    },\r\n//    更新用户列表\r\n    _displayUsers: function (users, me) {\r\n        const container = $('ul.users');\r\n        let html = '';\r\n        for (let i = 0; i < users.length; i++) {\r\n            html += users[i] == me ? `<li class=\"font_darkcyan\">${users[i]}</li>` : `<li><a href=\"#\">${users[i]}<span  style=\"display:none\" class=\"font_cornflowerblue\"> (正在输入)</span></a></li>`;\r\n        }\r\n        container.html(html);\r\n        $('p.count strong').html(users.length);\r\n    },\r\n//    显示表情\r\n    _showEmoji: function (msg) {\r\n        let match, result = msg,\r\n            reg = /\\[emoji:\\d+\\]/g,\r\n            emojiIndex,\r\n            totalEmojiNum = $('div.emoji_box').children().length;\r\n        while (match = reg.exec(msg)) {\r\n            emojiIndex = match[0].slice(7, -1);\r\n            //判断是否存在这个这个表情\r\n            if (emojiIndex > totalEmojiNum) {\r\n                result = result.replace(match[0], '[X]');\r\n            } else {\r\n                result = result.replace(match[0], ` <img class=\"emoji\" src=\"../resource/emoji/${emojiIndex}.gif\"/> `);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n};"]}